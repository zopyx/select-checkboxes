<html>
    <head>
        <script type="text/javascript" src="https://code.jquery.com/jquery-1.7.2.js"></script>
        <style type="text/css">
            div.select-checkbox {
                display: none;
                max-height: 150px;
                overflow: auto;
                max-width: 150px;
            }
        </style>
    </head>
    <body>
        <form action="#">
            <label for="test">Optionen Test 1</label>
            <select name="test" id="test" multiple="multiple" class="select-checkboxes">
                <option value="option1">option 1</option1>
                <option value="option2">option 2</option1>
                <option value="option1">option 1</option1>
                <option value="option2">option 2</option1>
                <option value="option3">option 3</option1>
                <option value="option4">option 4</option1>
                <option value="option5">option 5</option1>
                <option value="option3">option 3</option1>
                <option value="option4">option 4</option1>
                <option value="option5">option 5</option1>
                <option value="option1">option 1</option1>
                <option value="option2">option 2</option1>
                <option value="option3">option 3</option1>
                <option value="option4">option 4</option1>
                <option value="option5">option 5</option1>
                <option value="option1">option 1</option1>
                <option value="option2">option 2</option1>
                <option value="option3">option 3</option1>
                <option value="option4">option 4</option1>
                <option value="option5">option 5</option1>
                <option value="option1">option 1</option1>
                <option value="option2">option 2</option1>
                <option value="option3">option 3</option1>
                <option value="option4">option 4</option1>
                <option value="option5">option 5</option1>
                <option value="option1">option 1</option1>
                <option value="option2">option 2</option1>
                <option value="option3">option 3</option1>
                <option value="option4">option 4</option1>
                <option value="option5">option 5</option1>
                <option value="option1">option 1</option1>
                <option value="option2">option 2</option1>
                <option value="option3">option 3</option1>
                <option value="option4">option 4</option1>
                <option value="option5">option 5</option1>
                <option value="option1">option 1</option1>
                <option value="option2">option 2</option1>
                <option value="option3">option 3</option1>
                <option value="option4">option 4</option1>
                <option value="option5">option 5</option1>
            </select>

            <label for="foo">Optionen Test 2</label>
            <select name="foo" id="foo" multiple="multiple" class="select-checkboxes">
                <option value="optiona">option a</option1>
                <option value="optionb">option b</option1>
                <option value="optionc">option c</option1>
                <option value="optiond">option d</option1>
                <option value="optione">option e</option1>
            </select>
            <input type="submit" value="submit" />
        </form>        

        <script type="text/javascript">
            $(document).ready(function() {
                $('.select-checkboxes').each(function() {

                    // ID of <select>
                    var id = $(this).attr('id');

                    // related label (referred through its 'for' attribute
                    var label = $('*[for="' + id + '"]');
                    if (label.length == 0) { 
                        alert('<select> with ID "' + id + '" has no associated label');
                        return;
                    }
                    var label_text = $(label).html();

                    // added checkboxes
                    $(this).after('<div class="select-checkbox" data-id="' + id + '">');
                    var div = $('.select-checkbox[data-id="' + id + '"');
                    $(this).children('option').each(function() {
                        div.append('<div><input class="select-checkbox" type="checkbox" value="' +  $(this).attr('value') + '"/>' + $(this).html() + '</div>') ;
                    });
                    $(this).after('</div>');
                    $(this).after('<div class="toggle-select-checkbox" data-id="'  + id + '">' + label.html() + '</div>');

                    // hide <select> and related label element                    
                    $(this).hide();
                    label.hide();

                    // Toggler for div with checkboxes
                    $(document).on('click', '.toggle-select-checkbox', function(event) {
                        event.stopImmediatePropagation();
                        var id = $(this).data('id');
                        $('div.select-checkbox[data-id="' + id + '"]').toggle();
                    });

                    // Handle for checkboxes
                    $(document).on('click', 'div.select-checkbox', function() {
                        var selected_values = [];
                        $(this).find('input[type="checkbox"]').each(function() {
                            if ($(this).prop('checked')) {
                                var value = $(this).val();
                                selected_values.push(value);
                            }
                        });

                        var select = $('#' + id);
                        select.find('option:selected').prop('selected', false);
                        select.find('option').each(function() {
                            if (selected_values.indexOf($(this).val()) > -1) {
                                $(this).prop('selected', true);
                            }
                        });

                    });
                });

            });
        </script>


    </body>
</html>
